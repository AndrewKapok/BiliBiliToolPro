name: bilibili-daily-argv

on:
  workflow_dispatch:
  schedule:
    - cron: "37 0 * * 1-5" # 工作日 08:37 北京时间
    - cron: "34 2 * * 0,6" # 周末  10:34 北京时间

jobs:
  daily:
    runs-on: windows-latest
    steps:
      - name: checkout
        uses: actions/checkout@v4

      # 1. 下载并解压（Windows 版本）
      - name: download tool
        shell: pwsh
        run: |
          # 下载 Windows 版本的压缩包
          Invoke-WebRequest -Uri "https://github.com/RayWangQvQ/BiliBiliToolPro/releases/download/3.8.1/bilibili-tool-pro-v3.8.1-win-x64.zip" -OutFile "tool.zip"
          # 解压到当前目录
          Expand-Archive -Path "tool.zip" -DestinationPath "." -Force
          # 删除可能存在的配置文件（避免冲突）
          Remove-Item -Path "win-x64/appsettings*.json" -ErrorAction SilentlyContinue

      # 2. 复制默认配置到程序目录
      - name: copy base config
        shell: pwsh
        run: |
          Copy-Item -Path "./config/appsettings.json" -Destination "./win-x64/appsettings.json" -Force
          Write-Host "✅ Config copied to win-x64/"

      # 3. 运行程序（Windows 使用 .exe）
      - name: run with argv
        shell: pwsh
        run: |
          Set-Location "./win-x64"
          # 运行 Windows 可执行文件
          .\Ray.BiliBiliTool.Console.exe --cookieStr1="${{secrets.cookies}}" ${{ var.ARGV }}
